rng(1000);

conf = struct;
conf.n = 5;

conf.call = cell(conf.n, 1);
conf.call(:) = {(1:10)'};

% cash: 1
% stocks: 2-6
% vanilla 1:  7-16
% vanilla 2: 17-26
% vanilla 3: 27-36
% vanilla 4: 37-46
% vanilla 5: 47-56

conf.cbask = struct;
conf.cbask.W = [1/5, 1/5, 1/5, 1/5, 1/5; ...     57- 66
    1/4, 1/4, 1/4, 1/4, 0; ...                   67- 76
    0, 1/4, 1/4, 1/4, 1/4; ...                   77- 86
    1/4, 0, 1/4, 1/4, 1/4; ...                   87- 96
    1/4, 1/4, 1/4, 0, 1/4; ...                   97-106
    1/4, 1/4, 0, 1/4, 1/4; ...                  107-116
    1/3, 1/3, 1/3, 0, 0; ...                    117-126
    0, 1/3, 1/3, 1/3, 0; ...                    127-136
    0, 0, 1/3, 1/3, 1/3; ...                    137-146
    0, 1/2, 1/2, 0, 0; ...                      147-156
    0, 0, 1/2, 1/2, 0; ...                      157-166
    0, 1/2, 0, 1/2, 0; ...                      167-176
    1, -1, 0, 0, 0; ...                         177-187
    1, 0, -1, 0, 0; ...                         188-198
    1, 0, 0, -1, 0; ...                         199-209
    0, 1, -1, 0, 0; ...                         210-220
    0, 1, 0, -1, 0; ...                         221-231
    0, 1, 0, 0, -1; ...                         232-242
    0, 0, 1, -1, 0; ...                         243-253
    0, 0, 1, 0, -1; ...                         254-264
    0, 0, 0, 1, -1; ...                         265-275
    -1, 1, 0, 0, 0; ...                         276-286
    -1, 0, 1, 0, 0; ...                         287-297
    -1, 0, 0, 1, 0; ...                         298-308
    0, -1, 1, 0, 0; ...                         309-319
    0, -1, 0, 1, 0; ...                         320-330
    0, -1, 0, 0, 1; ...                         331-341
    0, 0, -1, 1, 0; ...                         342-352
    0, 0, -1, 0, 1; ...                         353-363
    0, 0, 0, -1, 1]; ...                        364-374
    
conf.cbask.k = cell(30, 1);
conf.cbask.k(1:12) = {(1:10)'};
conf.cbask.k(13:30) = {(-5:5)'};

conf.cmax = struct;
conf.cmax.L = [1, 1, 1, 1, 1; ...               375-385
    1, 1, 1, 1, 0; ...                          386-396
    0, 1, 1, 1, 1; ...                          397-407
    0, 1, 1, 0, 0; ...                          408-418
    0, 1, 0, 1, 0; ...                          419-429
    0, 0, 1, 1, 0; ...                          430-440
    0, 1, 1, 1, 0];
conf.cmax.k = cell(7, 1);
conf.cmax.k(1:6) = {(0:10)'};
conf.cmax.k{7} = (0:50)' / 50 * 10;

%   1: cash (1)
%   2-6: stocks (5)
%   7-56: vanilla options (10 * 5)
%   57-176: basket options (10 * 12)
%   177-374: spread options (11 * 18)
%   375-440: call-on-max (11 * 6)
%   441-491: call-on-max that is priced (51)


% marginal
marg = cell(1, 1);
marg{1} = struct;
marg{1}.mu = [0.5; 1; 1; 0.5; 0.5];
marg{1}.sig2 = [0.2; 0.4; 0.2; 0.4; 0.2];

% dependence
A = [0.8, 0.2; ...
    0.5, 0.5; ...
    0.7, -0.3; ...
    0.2, 0.8; ...
    -0.4, 0.6];

dep = cell(1, 1);
B = A * diag([2, 1]) * A' + eye(5) * 1;
dB = sqrt(diag(B));
dep{1}.rho = B ./ dB ./ dB';
dep{1}.rho(1:(5 + 1):end) = 1;
dep{1}.nu = 3;

price_bounds = simoptprice(conf, 1e6, marg, dep);
price_bounds = roundprice(price_bounds, 3);

save('exp/exp1/exp1.mat', 'conf', 'price_bounds', 'marg', 'dep');